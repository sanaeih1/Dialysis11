<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø¯ÛŒØ±ÛŒØª ØªØºØ°ÛŒÙ‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ø¯ÛŒØ§Ù„ÛŒØ²ÛŒ</title>
  <link href="https://cdn.jsdelivr.net/npm/vazir-font@28.0.0/dist/font-face.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/shabnam-font@5.0.0/dist/font-face.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/persian-date@1.1.0/dist/persian-date.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="manifest" href="https://sanaeih1.github.io/Dialysis11/manifest.json">
  <style>
    body {
      font-family: 'Shabnam', 'Vazir', sans-serif;
      margin: 0;
      padding: 8px;
      background-color: #FFF8E7;
      direction: rtl;
      text-align: right;
      color: #000000;
      overflow-x: hidden;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
    }

    h1 {
      font-size: 1.8rem;
      text-align: center;
      margin: 15px 0;
      font-weight: 500;
    }

    .intro-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #FFF8E7;
      padding: 20px;
      text-align: center;
    }

    .intro-page h1 {
      font-size: 2.8rem;
      color: #000000;
      margin-bottom: 15px;
      font-weight: bold;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .intro-tabs {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 10px;
      width: 100%;
      max-width: 1200px;
    }

    .tab-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      width: 100%;
      justify-content: center;
    }

    .intro-tab-button {
      color: white;
      padding: 18px 40px;
      border-radius: 15px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 3px 4px rgba(0, 0, 0, 0.2);
      height: 180px;
      font-weight: bold;
      background-color: #1a3c6d;
      width: calc(50% - 5px);
      max-width: 200px;
    }

    .intro-tab-button img {
      width: min(10vw, 70px);
      height: min(10vw, 70px);
      min-width: 50px;
      min-height: 50px;
    }

    .intro-tab-button.register { background-color: #0288d1; }
    .intro-tab-button.intakeHistory { background-color: #f57c00; }
    .intro-tab-button.videos { background-color: #7b1fa2; }
    .intro-tab-button.tutorial { background-color: #388e3c; }
    .intro-tab-button.settings { background-color: #455a64; }
    .intro-tab-button.about { background-color: #e64a19; }

    .intro-tab-button:hover {
      filter: brightness(1.15);
      transform: scale(1.05);
    }

    .content-area {
      display: none;
      flex-grow: 1;
      margin-top: 20px;
      padding-bottom: 15px;
    }

    .content-area.active {
      display: block;
    }

    .nav-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .nav-button {
      background-color: #7e57c2;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .nav-button img {
      width: min(10.5vw, 72px);
      height: min(7vw, 48px);
      min-width: 54px;
      min-height: 36px;
    }

    .nav-button:hover {
      background-color: #9575cd;
    }

    .tab-content {
      display: none;
      background-color: white;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      margin: 8px;
    }

    .tab-content.active {
      display: block;
    }

    h2, h3 {
      color: #000000;
      margin-bottom: 12px;
      font-size: 1.4rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    h2 img, h3 img {
      width: min(7vw, 52px);
      height: min(7vw, 52px);
      min-width: 36px;
      min-height: 36px;
    }

    p {
      line-height: 1.6;
      color: #000000;
      font-size: 1.2rem;
      margin-bottom: 8px;
    }

    small {
      color: #666;
      font-size: 0.9rem;
      display: block;
      margin-top: 4px;
    }

    .table-wrapper {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 400px;
      margin-top: 8px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
    }

    table, th, td {
      border: 1px solid #e0e0e0;
    }

    th, td {
      padding: 10px;
      text-align: center;
      font-size: 1rem;
    }

    th {
      background-color: #f5f5f5;
      font-weight: 500;
    }

    td {
      min-width: 100px;
    }

    tr:nth-child(even) {
      background-color: #fafafa;
    }

    button {
      padding: 10px 20px;
      margin: 6px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      width: 100%;
      max-width: 180px;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    button img {
      width: min(6vw, 44px);
      height: min(6vw, 44px);
      min-width: 32px;
      min-height: 32px;
    }

    .add-button, .edit-button {
      background-color: #66bb6a;
      color: white;
    }

    .add-button:hover, .edit-button:hover {
      background-color: #81c784;
    }

    .delete-button, .delete-all-button, .delete-all-data-button, .reset-settings-button {
      background-color: #ef5350;
      color: white;
    }

    .delete-button:hover, .delete-all-button:hover, .delete-all-data-button:hover, .reset-settings-button:hover {
      background-color: #f44336;
    }

    .save-button {
      background-color: #42a5f5;
      color: white;
    }

    .save-button:hover {
      background-color: #2196f3;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 350px;
      margin: 0 auto;
      background-color: #fafafa;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    input, select {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1.1rem;
      width: 100%;
      box-sizing: border-box;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    label {
      font-size: 1.1rem;
      color: #000000;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    label img {
      width: min(18vw, 132px);
      height: min(18vw, 132px);
      min-width: 96px;
      min-height: 96px;
    }

    .scrollable {
      overflow-x: auto;
      white-space: nowrap;
      padding: 8px 0;
      background-color: #fafafa;
      border-radius: 8px;
    }

    .scrollable p {
      display: inline-block;
      margin-right: 15px;
      font-size: 1.1rem;
      color: #000000;
    }

    .charts-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin: 15px 0;
    }

    .chart-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 200px;
      height: 280px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      padding: 12px;
      margin: 6px;
    }

    .chart-wrapper canvas {
      max-width: 100%;
      max-height: 180px;
    }

    .chart-wrapper span {
      font-size: 1.8rem;
      margin-top: 8px;
      color: #000000;
    }

    #warnings {
      margin: 15px 0;
    }

    .warning {
      background-color: #ffcccb;
      color: #d32f2f;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
      text-align: center;
      font-size: 1.1rem;
    }

    .error-message {
      background-color: #ffcccb;
      color: #d32f2f;
      padding: 10px;
      border-radius: 8px;
      margin: 8px 0;
      text-align: center;
      font-size: 1.1rem;
    }

    .offline-message {
      background-color: #ffcccb;
      color: #d32f2f;
      padding: 10px;
      border-radius: 8px;
      margin: 8px 0;
      text-align: center;
      font-size: 1.1rem;
      display: none;
    }

    .video-container {
      margin: 15px 0;
      background-color: white;
      padding: 12px;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      width: 100%;
      max-width: 640px;
      margin-left: auto;
      margin-right: auto;
    }

    .video-container iframe {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 8px;
    }

    .about-logo {
      max-width: min(80vw, 480px);
      max-height: min(80vw, 480px);
      min-width: 320px;
      min-height: 320px;
      height: auto;
      margin: 15px auto;
      display: block;
    }

    #about {
      overflow-y: auto;
      max-height: 80vh;
      -webkit-overflow-scrolling: touch;
    }

    #about iframe {
      width: 100%;
      max-width: 640px;
      height: min(720px, 120vw);
      border-radius: 8px;
      margin: 15px auto;
      display: block;
    }

    .search-container {
      position: relative;
      width: 100%;
      max-width: 350px;
    }

    .search-container input {
      padding-right: 40px;
    }

    .search-container img {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: min(7vw, 48px);
      height: min(7vw, 48px);
      min-width: 36px;
      min-height: 36px;
    }

    #intakeHistory table {
      margin-bottom: 20px;
      width: 100%;
      max-width: 350px;
      margin-left: auto;
      margin-right: auto;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .loader {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #1a3c6d;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      h1 {
        font-size: 1.6rem;
      }

      .intro-page h1 {
        font-size: 2.3rem;
      }

      .intro-tab-button {
        font-size: 1rem;
        padding: 15px 30px;
        height: 160px;
        width: calc(50% - 5px);
        max-width: 175px;
      }

      .intro-tab-button img {
        width: min(9.5vw, 66px);
        height: min(9.5vw, 66px);
        min-width: 46px;
        min-height: 46px;
      }

      table {
        font-size: 0.9rem;
      }

      th, td {
        padding: 8px;
        min-width: 80px;
      }

      button {
        padding: 8px 16px;
        font-size: 1rem;
        max-width: 160px;
      }

      button img {
        width: min(5.6vw, 40px);
        height: min(5.6vw, 40px);
        min-width: 28px;
        min-height: 28px;
      }

      input, select {
        font-size: 1rem;
        padding: 8px;
      }

      form {
        max-width: 320px;
        padding: 12px;
      }

      h2, h3 {
        font-size: 1.3rem;
      }

      h2 img, h3 img {
        width: min(6.6vw, 48px);
        height: min(6.6vw, 48px);
        min-width: 32px;
        min-height: 32px;
      }

      p, label {
        font-size: 1rem;
      }

      label img {
        width: min(16.8vw, 120px);
        height: min(16.8vw, 120px);
        min-width: 84px;
        min-height: 84px;
      }

      .charts-container {
        flex-direction: column;
        align-items: center;
      }

      .chart-wrapper {
        max-width: 180px;
        height: 260px;
      }

      .chart-wrapper canvas {
        max-height: 160px;
      }

      .chart-wrapper span {
        font-size: 1.6rem;
      }

      .scrollable p {
        font-size: 1rem;
      }

      .video-container {
        max-width: 100%;
      }

      .about-logo {
        max-width: min(72vw, 432px);
        max-height: min(72vw, 432px);
        min-width: 280px;
        min-height: 280px;
      }

      .table-wrapper {
        max-height: 300px;
      }

      .search-container img {
        width: min(6.6vw, 44px);
        height: min(6.6vw, 44px);
        min-width: 32px;
        min-height: 32px;
      }

      #about iframe {
        height: min(640px, 108vw);
      }

      .nav-button img {
        width: min(9.45vw, 65px);
        height: min(6.3vw, 43px);
        min-width: 48px;
        min-height: 32px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 1.4rem;
      }

      .intro-page h1 {
        font-size: 2rem;
      }

      .intro-tab-button {
        font-size: 0.9rem;
        padding: 12px 20px;
        height: 140px;
        width: 100%;
        max-width: 150px;
      }

      .intro-tab-button img {
        width: min(9vw, 62px);
        height: min(9vw, 62px);
        min-width: 42px;
        min-height: 42px;
      }

      table {
        font-size: 0.8rem;
      }

      th, td {
        padding: 6px;
        min-width: 60px;
      }

      button {
        padding: 6px 12px;
        font-size: 0.9rem;
        max-width: 140px;
      }

      button img {
        width: min(5.2vw, 36px);
        height: min(5.2vw, 36px);
        min-width: 24px;
        min-height: 24px;
      }

      input, select {
        font-size: 0.9rem;
        padding: 6px;
      }

      form {
        max-width: 280px;
        padding: 10px;
      }

      h2, h3 {
        font-size: 1.2rem;
      }

      h2 img, h3 img {
        width: min(6.4vw, 44px);
        height: min(6.4vw, 44px);
        min-width: 28px;
        min-height: 28px;
      }

      p, label {
        font-size: 0.9rem;
      }

      label img {
        width: min(15.6vw, 108px);
        height: min(15.6vw, 108px);
        min-width: 72px;
        min-height: 72px;
      }

      .charts-container {
        flex-direction: column;
        align-items: center;
      }

      .chart-wrapper {
        max-width: 100%;
        height: 240px;
        margin: 8px 0;
      }

      .chart-wrapper canvas {
        max-height: 150px;
      }

      .chart-wrapper span {
        font-size: 1.4rem;
      }

      .scrollable p {
        font-size: 0.9rem;
      }

      .video-container {
        max-width: 100%;
      }

      .about-logo {
        max-width: min(64vw, 384px);
        max-height: min(64vw, 384px);
        min-width: 240px;
        min-height: 240px;
      }

      .table-wrapper {
        max-height: 200px;
      }

      .search-container img {
        width: min(6.4vw, 40px);
        height: min(6.4vw, 40px);
        min-width: 28px;
        min-height: 28px;
      }

      #about iframe {
        height: min(560px, 96vw);
      }

      .nav-button img {
        width: min(9vw, 61px);
        height: min(6vw, 41px);
        min-width: 45px;
        min-height: 30px;
      }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
      .intro-tab-button {
        width: calc(33.33% - 10px);
        max-width: 250px;
      }

      .intro-tab-button img {
        width: min(9.5vw, 66px);
        height: min(9.5vw, 66px);
        min-width: 46px;
        min-height: 46px;
      }

      .nav-button img {
        width: min(9.45vw, 65px);
        height: min(6.3vw, 43px);
        min-width: 48px;
        min-height: 32px;
      }
    }
  </style>
</head>
<body>
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loader"></div>
  </div>
  <div class="intro-page" id="introPage">
    <h1>Ù…Ø¯ÛŒØ±ÛŒØª ØªØºØ°ÛŒÙ‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ø¯ÛŒØ§Ù„ÛŒØ²ÛŒ</h1>
    <div class="intro-tabs">
      <div class="tab-row">
        <button class="intro-tab-button register" onclick="openTab('dashboard')"><img src="https://sanaeih1.github.io/Dialysis11/assets/home.png" alt="home"> Ø«Ø¨Øª Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</button>
        <button class="intro-tab-button intakeHistory" onclick="openTab('intakeHistory')"><img src="https://sanaeih1.github.io/Dialysis11/assets/history.png" alt="history"> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ØµØ±Ù</button>
      </div>
      <div class="tab-row">
        <button class="intro-tab-button videos" onclick="openTab('videos')"><img src="https://sanaeih1.github.io/Dialysis11/assets/video.png" alt="video"> ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</button>
        <button class="intro-tab-button tutorial" onclick="openTab('tutorial')"><img src="https://sanaeih1.github.io/Dialysis11/assets/book.png" alt="book"> Ø¢Ù…ÙˆØ²Ø´ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</button>
      </div>
      <div class="tab-row">
        <button class="intro-tab-button settings" onclick="openTab('settings')"><img src="https://sanaeih1.github.io/Dialysis11/assets/settings.png" alt="settings"> ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
        <button class="intro-tab-button about" onclick="openTab('about')"><img src="https://sanaeih1.github.io/Dialysis11/assets/info.png" alt="info"> Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</button>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="content-area" id="contentArea">
      <div class="nav-buttons">
        <button class="nav-button" onclick="goBack()"><img src="https://sanaeih1.github.io/Dialysis11/assets/back.png" alt="back"> Ø¨Ø±Ú¯Ø´Øª</button>
      </div>
      <h1>Ù…Ø¯ÛŒØ±ÛŒØª ØªØºØ°ÛŒÙ‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ø¯ÛŒØ§Ù„ÛŒØ²ÛŒ</h1>
      <div id="errorMessage" class="error-message" style="display: none;"></div>
      <section id="dashboard" class="tab-content">
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/home.png" alt="home"> Ù…Ù‚Ø§Ø¯ÛŒØ± Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ</h2>
        <button class="delete-all-data-button" onclick="resetAllData()"><img src="https://sanaeih1.github.io/Dialysis11/assets/trash-alt.png" alt="trash-alt"> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
        <div class="charts-container">
          <div class="chart-wrapper">
            <canvas id="sodiumChart"></canvas>
            <span id="sodiumSticker">ğŸ˜Š</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="potassiumChart"></canvas>
            <span id="potassiumSticker">ğŸ˜Š</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="phosphorusChart"></canvas>
            <span id="phosphorusSticker">ğŸ˜Š</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="proteinChart"></canvas>
            <span id="proteinSticker">ğŸ˜Š</span>
          </div>
          <div class="chart-wrapper">
            <canvas id="waterChart"></canvas>
            <span id="waterSticker">ğŸ˜Š</span>
          </div>
        </div>
        <div id="warnings"></div>
        <div id="currentTotals" class="scrollable">
          <p>Ø³Ø¯ÛŒÙ… Ù…ØµØ±ÙÛŒ: <span id="totalSodiumMg">0</span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù… (Ø­Ø¯ Ù…Ø¬Ø§Ø²: <span id="sodiumLimitDisplayMg"></span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</p>
          <p>Ù¾ØªØ§Ø³ÛŒÙ… Ù…ØµØ±ÙÛŒ: <span id="totalPotassiumMg">0</span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù… (Ø­Ø¯ Ù…Ø¬Ø§Ø²: <span id="potassiumLimitDisplayMg"></span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</p>
          <p>ÙØ³ÙØ± Ù…ØµØ±ÙÛŒ: <span id="totalPhosphorusMg">0</span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù… (Ø­Ø¯ Ù…Ø¬Ø§Ø²: <span id="phosphorusLimitDisplayMg"></span> Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</p>
          <p>Ù¾Ø±ÙˆØªØ¦ÛŒÙ† Ù…ØµØ±ÙÛŒ: <span id="totalProteinMg">0</span> Ú¯Ø±Ù… (Ø­Ø¯ Ù…Ø¬Ø§Ø²: <span id="proteinLimitDisplayMg"></span> Ú¯Ø±Ù…)</p>
          <p>Ø¢Ø¨ Ù…ØµØ±ÙÛŒ: <span id="totalWaterMl">0</span> Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ± (Ø­Ø¯ Ù…Ø¬Ø§Ø²: <span id="waterLimitDisplayMl"></span> Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±)</p>
          <p>Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¯Ø±Ø§Ø± Û²Û´ Ø³Ø§Ø¹ØªÙ‡: <span id="dailyUrineOutput">0</span> Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±</p>
        </div>
        <h3><img src="https://sanaeih1.github.io/Dialysis11/assets/food.png" alt="food"> Ø«Ø¨Øª Ù…ØµØ±Ù ØºØ°Ø§</h3>
        <form id="foodIntakeForm" onsubmit="addIntake(event)">
          <div class="search-container">
            <label for="foodSearch"><img src="https://sanaeih1.github.io/Dialysis11/assets/search.png" alt="search"> Ø¬Ø³ØªØ¬ÙˆÛŒ ØºØ°Ø§:</label>
            <input type="text" id="foodSearch" name="foodSearch" placeholder="Ù†Ø§Ù… ØºØ°Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯">
            <img src="https://sanaeih1.github.io/Dialysis11/assets/search.png" alt="search">
          </div>
          <label for="foodSelect"><img src="https://sanaeih1.github.io/Dialysis11/assets/list.png" alt="list"> Ø§Ù†ØªØ®Ø§Ø¨ ØºØ°Ø§:</label>
          <select id="foodSelect" name="foodSelect" required>
            <option value="">ÛŒÚ© ØºØ°Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>
          </select>
          <label for="quantity"><img src="https://sanaeih1.github.io/Dialysis11/assets/weight.png" alt="weight"> Ù…Ù‚Ø¯Ø§Ø± (ÙˆØ§Ø­Ø¯):</label>
          <input type="number" id="quantity" name="quantity" step="0.01" required>
          <label for="mealType"><img src="https://sanaeih1.github.io/Dialysis11/assets/clock.png" alt="clock"> ÙˆØ¹Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ:</label>
          <select id="mealType" name="mealType" required>
            <option value="ØµØ¨Ø­Ø§Ù†Ù‡">ØµØ¨Ø­Ø§Ù†Ù‡</option>
            <option value="Ù†Ø§Ù‡Ø§Ø±">Ù†Ø§Ù‡Ø§Ø±</option>
            <option value="Ø´Ø§Ù…">Ø´Ø§Ù…</option>
            <option value="Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡">Ù…ÛŒØ§Ù†â€ŒÙˆØ¹Ø¯Ù‡</option>
          </select>
          <button type="submit" class="add-button"><img src="https://sanaeih1.github.io/Dialysis11/assets/plus.png" alt="plus"> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†</button>
        </form>
        <h3><img src="https://sanaeih1.github.io/Dialysis11/assets/water-glass.png" alt="water-glass"> Ø«Ø¨Øª Ù…ØµØ±Ù Ø¢Ø¨ (Ù„ÛŒÙˆØ§Ù† Û²Û°Û° Ø³ÛŒâ€ŒØ³ÛŒ)</h3>
        <form id="waterIntakeForm" onsubmit="addWaterIntake(event)">
          <label for="waterCups"><img src="https://sanaeih1.github.io/Dialysis11/assets/water-drop.png" alt="water-drop"> ØªØ¹Ø¯Ø§Ø¯ Ù„ÛŒÙˆØ§Ù†â€ŒÙ‡Ø§:</label>
          <input type="number" id="waterCups" name="waterCups" step="0.01" required>
          <button type="submit" class="add-button"><img src="https://sanaeih1.github.io/Dialysis11/assets/plus.png" alt="plus"> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†</button>
        </form>
        <h3><img src="https://sanaeih1.github.io/Dialysis11/assets/urine.png" alt="urine"> Ø«Ø¨Øª Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¯Ø±Ø§Ø± (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±)</h3>
        <form id="urineIntakeForm" onsubmit="addUrineOutput(event)">
          <label for="urineAmount"><img src="https://sanaeih1.github.io/Dialysis11/assets/water-drop.png" alt="water-drop"> Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¯Ø±Ø§Ø± (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±):</label>
          <input type="number" id="urineAmount" name="urineAmount" step="0.01" required>
          <button type="submit" class="add-button"><img src="https://sanaeih1.github.io/Dialysis11/assets/plus.png" alt="plus"> Ø«Ø¨Øª</button>
        </form>
      </section>
      <section id="videos" class="tab-content">
        <div id="offlineMessage" class="offline-message">Ø´Ù…Ø§ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‡Ø³ØªÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯.</div>
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/video.png" alt="video"> ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ</h2>
        <div class="video-container">
          <h3>Ø±Ú˜ÛŒÙ… Ø®Ø§Øµ</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/vhf4z5z/vt/frame" allowfullscreen="true"></iframe>
        </div>
        <div class="video-container">
          <h3>ÙØ³ÙØ±</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/hlqzdki/vt/frame" allowfullscreen="true"></iframe>
        </div>
        <div class="video-container">
          <h3>Ù¾ØªØ§Ø³ÛŒÙ…</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/ifu44gz/vt/frame" allowfullscreen="true"></iframe>
        </div>
        <div class="video-container">
          <h3>Ø³Ø¯ÛŒÙ… Ùˆ Ø¢Ø¨</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/lof5k6h/vt/frame" allowfullscreen="true"></iframe>
        </div>
        <div class="video-container">
          <h3>Ù‚Ù†Ø¯</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/hjc3195/vt/frame" allowfullscreen="true"></iframe>
        </div>
      </section>
      <section id="tutorial" class="tab-content">
        <div id="tutorialOfflineMessage" class="offline-message">Ø´Ù…Ø§ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‡Ø³ØªÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ Ø¨Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª Ù…ØªØµÙ„ Ø´ÙˆÛŒØ¯.</div>
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/book.png" alt="book"> Ø¢Ù…ÙˆØ²Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†</h2>
        <div class="video-container">
          <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ØªØºØ°ÛŒÙ‡ Ø¯ÛŒØ§Ù„ÛŒØ²ÛŒ</h3>
          <iframe class="video-iframe" data-src="https://www.aparat.com/video/video/embed/videohash/TUTORIAL123/vt/frame" allowfullscreen="true"></iframe>
        </div>
      </section>
      <section id="intakeHistory" class="tab-content">
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/history.png" alt="history"> ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…ØµØ±Ù Ù…ÙˆØ§Ø¯ ØºØ°Ø§ÛŒÛŒ Ø´Ù…Ø§</h2>
        <button class="delete-all-button" onclick="deleteAllIntakes()"><img src="https://sanaeih1.github.io/Dialysis11/assets/trash.png" alt="trash"> Ø­Ø°Ù Ù‡Ù…Ù‡</button>
        <div class="table-wrapper">
          <div id="intakeTableBody"></div>
        </div>
      </section>
      <section id="settings" class="tab-content">
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/settings.png" alt="settings"> ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
        <form id="settingsForm" onsubmit="saveSettings(event)">
          <label for="ibw"><img src="https://sanaeih1.github.io/Dialysis11/assets/weight.png" alt="weight"> ÙˆØ²Ù† Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ (Ú©ÛŒÙ„ÙˆÚ¯Ø±Ù…):</label>
          <input type="number" id="ibw" name="ibw" step="0.01" required oninput="updateLimitsBasedOnIBW()">
          <label for="urineOutput"><img src="https://sanaeih1.github.io/Dialysis11/assets/water-drop.png" alt="water-drop"> Ù…Ù‚Ø¯Ø§Ø± Ø§Ø¯Ø±Ø§Ø± Ø±ÙˆØ²Ø§Ù†Ù‡ (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±):</label>
          <input type="number" id="urineOutput" name="urineOutput" step="0.01">
          <label for="fontSize"><img src="https://sanaeih1.github.io/Dialysis11/assets/font-size.png" alt="font-size"> Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª:</label>
          <select id="fontSize" name="fontSize">
            <option value="small">Ú©ÙˆÚ†Ú©</option>
            <option value="medium">Ù…ØªÙˆØ³Ø·</option>
            <option value="large">Ø¨Ø²Ø±Ú¯</option>
          </select>
          <label for="sodiumLimit"><img src="https://sanaeih1.github.io/Dialysis11/assets/sodium.png" alt="sodium"> Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø³Ø¯ÛŒÙ… (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…):</label>
          <input type="number" id="sodiumLimit" name="sodiumLimit" step="0.01">
          <label for="potassiumLimit"><img src="https://sanaeih1.github.io/Dialysis11/assets/potassium.png" alt="potassium"> Ø­Ø¯ Ù…Ø¬Ø§Ø² Ù¾ØªØ§Ø³ÛŒÙ… (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…):</label>
          <input type="number" id="potassiumLimit" name="potassiumLimit" step="0.01">
          <label for="phosphorusLimit"><img src="https://sanaeih1.github.io/Dialysis11/assets/phosphorus.png" alt="phosphorus"> Ø­Ø¯ Ù…Ø¬Ø§Ø² ÙØ³ÙØ± (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…):</label>
          <input type="number" id="phosphorusLimit" name="phosphorusLimit" step="0.01">
          <label for="proteinLimit"><img src="https://sanaeih1.github.io/Dialysis11/assets/protein.png" alt="protein"> Ø­Ø¯ Ù…Ø¬Ø§Ø² Ù¾Ø±ÙˆØªØ¦ÛŒÙ† (Ú¯Ø±Ù…):</label>
          <input type="number" id="proteinLimit" name="proteinLimit" step="0.01">
          <label for="waterLimit"><img src="https://sanaeih1.github.io/Dialysis11/assets/water.png" alt="water"> Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø¢Ø¨ (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±):</label>
          <input type="number" id="waterLimit" name="waterLimit" step="0.01">
          <button type="submit" class="save-button"><img src="https://sanaeih1.github.io/Dialysis11/assets/save.png" alt="save"> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
          <button type="button" class="reset-settings-button" onclick="resetSettings()"><img src="https://sanaeih1.github.io/Dialysis11/assets/trash-alt.png" alt="trash-alt"> Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
        </form>
      </section>
      <section id="about" class="tab-content">
        <h2><img src="https://sanaeih1.github.io/Dialysis11/assets/info.png" alt="info"> Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</h2>
        <img src="https://sanaeih1.github.io/Dialysis11/mums_logo.png" alt="Ù„ÙˆÚ¯Ùˆ Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡ Ø¹Ù„ÙˆÙ… Ù¾Ø²Ø´Ú©ÛŒ Ù…Ø´Ù‡Ø¯" class="about-logo">
        <iframe src="https://sanaeih1.github.io/Dialysis11/contact.html" title="Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§"></iframe>
      </section>
    </div>
  </div>
  <script>
    let pageHistory = [];

    function generateDeviceId() {
      const userAgent = navigator.userAgent;
      const randomString = Math.random().toString(36).substring(2, 15);
      return btoa(userAgent + randomString).substring(0, 20);
    }

    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
      deviceId = generateDeviceId();
      localStorage.setItem('deviceId', deviceId);
    }

    const storageKey = `dialysisAppData_${deviceId}`;
    let userData = {};
    try {
      userData = JSON.parse(localStorage.getItem(storageKey)) || {};
    } catch (e) {
      console.error('Error loading data from localStorage:', e);
      userData = {};
    }

    userData = {
      intakeHistory: userData.intakeHistory || [],
      foodDB: userData.foodDB || [],
      limits: userData.limits || {
        sodium: 1500,
        potassium: 2000,
        phosphorus: 800,
        protein: 80,
        water: 750
      },
      ibw: userData.ibw || null,
      urineOutput: userData.urineOutput || null,
      fontSize: userData.fontSize || 'large'
    };

    let intakeHistory = userData.intakeHistory;
    let foodDB = userData.foodDB;
    let limits = userData.limits;
    let charts = {};

    async function loadFoodDatabaseFromJSON() {
      const jsonURL = 'https://sanaeih1.github.io/Dialysis11/foods.json';
      try {
        const response = await fetch(jsonURL);
        if (!response.ok) {
          throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„ JSON');
        }
        const newFoods = await response.json();
        const requiredFields = ['name', 'category', 'sodium', 'potassium', 'phosphorus', 'water', 'bloodSugarImpact', 'restrictions', 'unit'];
        const optionalFields = ['protein', 'carb', 'fat', 'kcal', 'calcium'];
        const isValid = newFoods.every(food =>
          requiredFields.every(field => food.hasOwnProperty(field)) &&
          typeof food.sodium === 'number' &&
          typeof food.potassium === 'number' &&
          typeof food.phosphorus === 'number' &&
          typeof food.water === 'number'
        );

        if (!isValid) {
          showError('ÙØ§ÛŒÙ„ JSON Ø³Ø§Ø®ØªØ§Ø± Ù…Ø¹ØªØ¨Ø±ÛŒ Ù†Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù‡Ø³ØªÙ†Ø¯.');
          return;
        }

        newFoods.forEach(food => {
          food.protein = food.protein !== undefined ? food.protein : 0;
          food.carb = food.carb !== undefined ? food.carb : 0;
          food.fat = food.fat !== undefined ? food.fat : 0;
          food.kcal = food.kcal !== undefined ? food.kcal : 0;
          food.calcium = food.calcium !== undefined ? food.calcium : 0;
        });

        foodDB = [...foodDB, ...newFoods];
        saveData();
        populateFoodSelect();
      } catch (e) {
        showError('Ø®Ø·Ø§ Ø¯Ø± Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ JSON. Ù„Ø·ÙØ§Ù‹ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª ÛŒØ§ Ø¢Ø¯Ø±Ø³ ÙØ§ÛŒÙ„ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
        console.error('Error loading JSON:', e);
        if (!foodDB.length) {
          foodDB = [
            {
              name: "ØºØ°Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶",
              category: "Ù…ØªÙØ±Ù‚Ù‡",
              sodium: 0,
              potassium: 0,
              phosphorus: 0,
              protein: 0,
              water: 0,
              carb: 0,
              fat: 0,
              kcal: 0,
              calcium: 0,
              bloodSugarImpact: "Ú©Ù…",
              restrictions: { sodium: "Ú©Ù…", potassium: "Ú©Ù…", phosphorus: "Ú©Ù…", calcium: "Ú©Ù…" },
              unit: "Ú¯Ø±Ù…"
            }
          ];
          populateFoodSelect();
        }
      }
    }

    window.onload = function() {
      const loadingOverlay = document.getElementById('loadingOverlay');
      Promise.all([
        loadFoodDatabaseFromJSON(),
        document.fonts.ready
      ]).then(() => {
        applySettings();
        loadSettings();
        populateFoodSelect();
        displayIntakeHistory();
        updateDashboard();
        checkOnlineStatus();
        if (loadingOverlay) loadingOverlay.style.display = 'none';
      }).catch(error => {
        console.error('Error during loading:', error);
        showError('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        if (loadingOverlay) loadingOverlay.style.display = 'none';
      });
      const foodSearch = document.getElementById('foodSearch');
      if (foodSearch) foodSearch.addEventListener('input', filterFoodSelect);
      const ibw = document.getElementById('ibw');
      if (ibw) ibw.addEventListener('input', updateLimitsBasedOnIBW);
      window.addEventListener('online', checkOnlineStatus);
      window.addEventListener('offline', checkOnlineStatus);
    };

    function checkOnlineStatus() {
      const offlineMessage = document.getElementById('offlineMessage');
      const tutorialOfflineMessage = document.getElementById('tutorialOfflineMessage');
      const iframes = document.getElementsByClassName('video-iframe');
      if (!navigator.onLine) {
        if (offlineMessage) offlineMessage.style.display = 'block';
        if (tutorialOfflineMessage) tutorialOfflineMessage.style.display = 'block';
        for (let iframe of iframes) {
          iframe.src = '';
        }
      } else {
        if (offlineMessage) offlineMessage.style.display = 'none';
        if (tutorialOfflineMessage) tutorialOfflineMessage.style.display = 'none';
        for (let iframe of iframes) {
          const dataSrc = iframe.getAttribute('data-src');
          if (dataSrc) iframe.src = dataSrc;
        }
      }
    }

    function applySettings() {
      applyFontSize(userData.fontSize);
    }

    function loadSettings() {
      if (userData.ibw) {
        const ibwInput = document.getElementById('ibw');
        if (ibwInput) {
          ibwInput.value = userData.ibw.toFixed(2);
          updateLimitsBasedOnIBW();
        }
      }
      if (userData.urineOutput) {
        const urineOutputInput = document.getElementById('urineOutput');
        if (urineOutputInput) urineOutputInput.value = userData.urineOutput.toFixed(2);
      }
      const fontSizeSelect = document.getElementById('fontSize');
      if (fontSizeSelect) fontSizeSelect.value = userData.fontSize || 'large';
      displayLimits();
    }

    function updateLimitsBasedOnIBW() {
      const ibwInput = document.getElementById('ibw');
      const urineOutputInput = document.getElementById('urineOutput');
      if (!ibwInput || !urineOutputInput) return;
      const ibw = parseFloat(ibwInput.value);
      const urineOutput = parseFloat(urineOutputInput.value) || 0;

      if (!isNaN(ibw) && ibw > 0) {
        limits = {
          sodium: 1500,
          potassium: parseFloat((40 * ibw).toFixed(2)),
          phosphorus: parseFloat((17 * ibw).toFixed(2)),
          protein: parseFloat((1.2 * ibw).toFixed(2)),
          water: parseFloat((750 + urineOutput).toFixed(2))
        };
        userData.ibw = ibw;
        userData.urineOutput = urineOutput;
        displayLimits();
        updateDashboard();
        saveData();
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
          errorDiv.style.display = 'none';
        }, 5000);
      }
    }

    function applyFontSize(size) {
      let fontSize;
      switch (size) {
        case 'small': fontSize = '0.9rem'; break;
        case 'medium': fontSize = '1rem'; break;
        case 'large': fontSize = '1.2rem'; break;
        default: fontSize = '1.2rem';
      }
      document.documentElement.style.fontSize = fontSize;
      userData.fontSize = size;
      saveData();
    }

    function saveData() {
      try {
        userData.intakeHistory = intakeHistory;
        userData.foodDB = foodDB;
        userData.limits = limits;
        const ibwInput = document.getElementById('ibw');
        userData.ibw = ibwInput ? parseFloat(ibwInput.value) || userData.ibw || null : userData.ibw;
        const urineOutputInput = document.getElementById('urineOutput');
        userData.urineOutput = urineOutputInput ? parseFloat(urineOutputInput.value) || userData.urineOutput || null : userData.urineOutput;
        const fontSizeSelect = document.getElementById('fontSize');
        userData.fontSize = fontSizeSelect ? fontSizeSelect.value || userData.fontSize || 'large' : userData.fontSize;
        localStorage.setItem(storageKey, JSON.stringify(userData));
      } catch (e) {
        showError('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.');
        console.error('Error saving data to localStorage:', e);
      }
    }

    function saveSettings(event) {
      event.preventDefault();
      const ibwInput = document.getElementById('ibw');
      const urineOutputInput = document.getElementById('urineOutput');
      if (!ibwInput || !urineOutputInput) return;
      const ibw = parseFloat(ibwInput.value);
      const urineOutput = parseFloat(urineOutputInput.value) || 0;

      if (isNaN(ibw) || ibw <= 0) {
        showError('Ù„Ø·ÙØ§Ù‹ ÙˆØ²Ù† Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ Ù…Ø¹ØªØ¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        return;
      }

      userData.ibw = ibw;
      userData.urineOutput = urineOutput;

      limits = {
        sodium: parseFloat(document.getElementById('sodiumLimit').value) || 1500,
        potassium: parseFloat(document.getElementById('potassiumLimit').value) || parseFloat((40 * ibw).toFixed(2)),
        phosphorus: parseFloat(document.getElementById('phosphorusLimit').value) || parseFloat((17 * ibw).toFixed(2)),
        protein: parseFloat(document.getElementById('proteinLimit').value) || parseFloat((1.2 * ibw).toFixed(2)),
        water: parseFloat(document.getElementById('waterLimit').value) || parseFloat((750 + urineOutput).toFixed(2))
      };

      saveData();
      displayLimits();
      updateDashboard();
      applyFontSize(document.getElementById('fontSize').value);
      showError('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.');
    }

    function resetSettings() {
      if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø±Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ú©Ù†ÛŒØ¯ØŸ')) {
        userData.limits = {
          sodium: 1500,
          potassium: 2000,
          phosphorus: 800,
          protein: 80,
          water: 750
        };
        userData.ibw = null;
        userData.urineOutput = null;
        userData.fontSize = 'large';
        saveData();
        loadSettings();
        applySettings();
        updateDashboard();
        showError('ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯.');
      }
    }

    function resetAllData() {
      if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ ØºØ°Ø§Ù‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø­ÙØ¸ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯.')) {
        intakeHistory = [];
        foodDB = [];
        loadFoodDatabaseFromJSON();
        saveData();
        populateFoodSelect();
        displayIntakeHistory();
        updateDashboard();
        showError('ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ ØºØ°Ø§Ù‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯.');
      }
    }

    function openTab(tabName) {
      document.getElementById('introPage').style.display = 'none';
      document.getElementById('contentArea').style.display = 'block';
      const tabContents = document.getElementsByClassName('tab-content');
      for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
      }
      const tab = document.getElementById(tabName);
      if (tab) tab.classList.add('active');
      pageHistory.push(tabName);
      if (tabName === 'videos' || tabName === 'tutorial') {
        checkOnlineStatus();
      }
    }

    function goBack() {
      if (pageHistory.length > 1) {
        pageHistory.pop();
        const previousPage = pageHistory[pageHistory.length - 1];
        openTab(previousPage);
      } else {
        document.getElementById('introPage').style.display = 'block';
        document.getElementById('contentArea').style.display = 'none';
        const tabContents = document.getElementsByClassName('tab-content');
        for (let i = 0; i < tabContents.length; i++) {
          tabContents[i].classList.remove('active');
        }
        pageHistory = [];
      }
    }

    function populateFoodSelect(searchTerm = '') {
      const foodSelect = document.getElementById('foodSelect');
      if (!foodSelect) return;
      foodSelect.innerHTML = '<option value="">ÛŒÚ© ØºØ°Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</option>';
      foodDB
        .filter(food => searchTerm === '' || food.name.toLowerCase().includes(searchTerm.toLowerCase()))
        .forEach((food, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = `${food.name} (${food.unit})`;
          foodSelect.appendChild(option);
        });
    }

    function filterFoodSelect() {
      const foodSearch = document.getElementById('foodSearch');
      if (foodSearch) {
        const searchTerm = foodSearch.value;
        populateFoodSelect(searchTerm);
      }
    }

    function addIntake(event) {
      event.preventDefault();
      const foodSelect = document.getElementById('foodSelect');
      const quantityInput = document.getElementById('quantity');
      const mealTypeSelect = document.getElementById('mealType');
      if (!foodSelect || !quantityInput || !mealTypeSelect) return;

      const foodIndex = parseInt(foodSelect.value, 10);
      const quantity = parseFloat(quantityInput.value);
      const mealType = mealTypeSelect.value;

      if (isNaN(foodIndex) || foodIndex < 0 || foodIndex >= foodDB.length) {
        showError('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ØºØ°Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
        return;
      }
      if (isNaN(quantity) || quantity <= 0) {
        showError('Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        return;
      }
      if (!mealType) {
        showError('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙˆØ¹Ø¯Ù‡ ØºØ°Ø§ÛŒÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.');
        return;
      }

      const food = foodDB[foodIndex];
      let date;
      try {
        const persianDateInstance = new persianDate();
        date = persianDateInstance.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'food',
        date: date,
        timestamp: timestamp,
        mealType: mealType,
        food: food.name,
        quantity: quantity,
        unit: food.unit,
        sodium: parseFloat(((food.sodium || 0) * quantity).toFixed(2)),
        potassium: parseFloat(((food.potassium || 0) * quantity).toFixed(2)),
        phosphorus: parseFloat(((food.phosphorus || 0) * quantity).toFixed(2)),
        protein: parseFloat(((food.protein || 0) * quantity).toFixed(2)),
        water: parseFloat(((food.water || 0) * quantity).toFixed(2)),
        urine: 0
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      foodSelect.selectedIndex = 0;
      quantityInput.value = '';
      mealTypeSelect.selectedIndex = 0;
      const foodSearch = document.getElementById('foodSearch');
      if (foodSearch) {
        foodSearch.value = '';
        populateFoodSelect();
      }
    }

    function addWaterIntake(event) {
      event.preventDefault();
      const waterCupsInput = document.getElementById('waterCups');
      if (!waterCupsInput) return;
      const cups = parseFloat(waterCupsInput.value);

      if (isNaN(cups) || cups <= 0) {
        showError('Ù„Ø·ÙØ§Ù‹ ØªØ¹Ø¯Ø§Ø¯ Ù„ÛŒÙˆØ§Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        return;
      }

      const waterAmount = parseFloat((cups * 200).toFixed(2));

      let date;
      try {
        const persianDateInstance = new persianDate();
        date = persianDateInstance.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'water',
        date: date,
        timestamp: timestamp,
        mealType: '-',
        food: `Ø¢Ø¨ (${cups} Ù„ÛŒÙˆØ§Ù†)`,
        quantity: cups,
        unit: 'Ù„ÛŒÙˆØ§Ù†',
        sodium: 0,
        potassium: 0,
        phosphorus: 0,
        protein: 0,
        water: waterAmount,
        urine: 0
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      waterCupsInput.value = '';
    }

    function addUrineOutput(event) {
      event.preventDefault();
      const urineAmountInput = document.getElementById('urineAmount');
      if (!urineAmountInput) return;
      const urineAmount = parseFloat(urineAmountInput.value);

      if (isNaN(urineAmount) || urineAmount <= 0) {
        showError('Ù„Ø·ÙØ§Ù‹ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø¹ØªØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ø±Ø§Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
        return;
      }

      let date;
      try {
        const persianDateInstance = new persianDate();
        date = persianDateInstance.format('dddd D MMMM YYYY');
      } catch (e) {
        console.error('Error with persianDate:', e);
        date = new Date().toLocaleDateString('fa-IR');
      }

      const timestamp = new Date().getTime();

      const intake = {
        type: 'urine',
        date: date,
        timestamp: timestamp,
        mealType: '-',
        food: 'Ø§Ø¯Ø±Ø§Ø±',
        quantity: parseFloat(urineAmount.toFixed(2)),
        unit: 'Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±',
        sodium: 0,
        potassium: 0,
        phosphorus: 0,
        protein: 0,
        water: 0,
        urine: parseFloat(urineAmount.toFixed(2))
      };

      intakeHistory.push(intake);
      saveData();
      displayIntakeHistory();
      updateDashboard();

      urineAmountInput.value = '';
    }

    function calculateDailyUrineOutput() {
      const now = new Date().getTime();
      const oneDayInMs = 24 * 60 * 60 * 1000;
      const recentUrine = intakeHistory.filter(item => {
        return item.type === 'urine' && (now - item.timestamp) <= oneDayInMs;
      });
      return parseFloat(recentUrine.reduce((sum, item) => sum + (item.urine || 0), 0).toFixed(2));
    }

    function displayIntakeHistory() {
      const intakeTableBody = document.getElementById('intakeTableBody');
      if (!intakeTableBody) return;
      intakeTableBody.innerHTML = '';
      intakeHistory.forEach((intake, index) => {
        const table = document.createElement('table');
        table.innerHTML = `
          <thead>
            <tr><th>Ù¾Ø§Ø±Ø§Ù…ØªØ±</th><th>Ù…Ù‚Ø¯Ø§Ø±</th></tr>
          </thead>
          <tbody>
            <tr><td>ØªØ§Ø±ÛŒØ®</td><td>${intake.date || '-'}</td></tr>
            <tr><td>Ù†ÙˆØ¹</td><td>${intake.type === 'food' ? intake.mealType : (intake.type === 'water' ? 'Ø¢Ø¨' : 'Ø§Ø¯Ø±Ø§Ø±')}</td></tr>
            <tr><td>ØºØ°Ø§/Ø¢Ø¨/Ø§Ø¯Ø±Ø§Ø±</td><td>${intake.food || '-'}</td></tr>
            <tr><td>Ù…Ù‚Ø¯Ø§Ø±</td><td>${intake.quantity || 0} ${intake.unit || ''}</td></tr>
            <tr><td>Ø³Ø¯ÛŒÙ… (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</td><td>${(intake.sodium || 0).toFixed(2)}</td></tr>
            <tr><td>Ù¾ØªØ§Ø³ÛŒÙ… (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</td><td>${(intake.potassium || 0).toFixed(2)}</td></tr>
            <tr><td>ÙØ³ÙØ± (Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…)</td><td>${(intake.phosphorus || 0).toFixed(2)}</td></tr>
            <tr><td>Ù¾Ø±ÙˆØªØ¦ÛŒÙ† (Ú¯Ø±Ù…)</td><td>${(intake.protein || 0).toFixed(2)}</td></tr>
            <tr><td>Ø¢Ø¨ (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±)</td><td>${(intake.water || 0).toFixed(2)}</td></tr>
            <tr><td>Ø§Ø¯Ø±Ø§Ø± (Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±)</td><td>${(intake.urine || 0).toFixed(2)}</td></tr>
            <tr><td>Ø¹Ù…Ù„ÛŒØ§Øª</td><td><button class="delete-button" onclick="deleteIntake(${index})"><img src="https://sanaeih1.github.io/Dialysis11/assets/trash.png" alt="trash"> Ø­Ø°Ù</button></td></tr>
          </tbody>
        `;
        intakeTableBody.appendChild(table);
      });
    }

    function deleteIntake(index) {
      intakeHistory.splice(index, 1);
      saveData();
      displayIntakeHistory();
      updateDashboard();
    }

    function deleteAllIntakes() {
      if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù‡Ù…Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ Ø±Ø§ Ø­Ø°Ù Ú©Ù†ÛŒØ¯ØŸ')) {
        intakeHistory = [];
        saveData();
        displayIntakeHistory();
        updateDashboard();
      }
    }

    function displayLimits() {
      const sodiumLimitDisplay = document.getElementById('sodiumLimitDisplayMg');
      const potassiumLimitDisplay = document.getElementById('potassiumLimitDisplayMg');
      const phosphorusLimitDisplay = document.getElementById('phosphorusLimitDisplayMg');
      const proteinLimitDisplay = document.getElementById('proteinLimitDisplayMg');
      const waterLimitDisplay = document.getElementById('waterLimitDisplayMl');
      if (sodiumLimitDisplay) sodiumLimitDisplay.textContent = limits.sodium.toFixed(2);
      if (potassiumLimitDisplay) potassiumLimitDisplay.textContent = limits.potassium.toFixed(2);
      if (phosphorusLimitDisplay) phosphorusLimitDisplay.textContent = limits.phosphorus.toFixed(2);
      if (proteinLimitDisplay) proteinLimitDisplay.textContent = limits.protein.toFixed(2);
      if (waterLimitDisplay) waterLimitDisplay.textContent = limits.water.toFixed(2);

      const sodiumLimitInput = document.getElementById('sodiumLimit');
      const potassiumLimitInput = document.getElementById('potassiumLimit');
      const phosphorusLimitInput = document.getElementById('phosphorusLimit');
      const proteinLimitInput = document.getElementById('proteinLimit');
      const waterLimitInput = document.getElementById('waterLimit');
      if (sodiumLimitInput) sodiumLimitInput.value = limits.sodium.toFixed(2);
      if (potassiumLimitInput) potassiumLimitInput.value = limits.potassium.toFixed(2);
      if (phosphorusLimitInput) phosphorusLimitInput.value = limits.phosphorus.toFixed(2);
      if (proteinLimitInput) proteinLimitInput.value = limits.protein.toFixed(2);
      if (waterLimitInput) waterLimitInput.value = limits.water.toFixed(2);
    }

    function updateDashboard() {
      const now = new Date().getTime();
      const oneDayInMs = 24 * 60 * 60 * 1000;
      const recentIntakes = intakeHistory.filter(item => {
        return (now - item.timestamp) <= oneDayInMs;
      });

      const totals = recentIntakes.reduce((acc, item) => {
        acc.sodium += item.sodium || 0;
        acc.potassium += item.potassium || 0;
        acc.phosphorus += item.phosphorus || 0;
        acc.protein += item.protein || 0;
        acc.water += item.water || 0;
        return acc;
      }, { sodium: 0, potassium: 0, phosphorus: 0, protein: 0, water: 0 });

      const totalSodiumMg = document.getElementById('totalSodiumMg');
      const totalPotassiumMg = document.getElementById('totalPotassiumMg');
      const totalPhosphorusMg = document.getElementById('totalPhosphorusMg');
      const totalProteinMg = document.getElementById('totalProteinMg');
      const totalWaterMl = document.getElementById('totalWaterMl');
      if (totalSodiumMg) totalSodiumMg.textContent = totals.sodium.toFixed(2);
      if (totalPotassiumMg) totalPotassiumMg.textContent = totals.potassium.toFixed(2);
      if (totalPhosphorusMg) totalPhosphorusMg.textContent = totals.phosphorus.toFixed(2);
      if (totalProteinMg) totalProteinMg.textContent = totals.protein.toFixed(2);
      if (totalWaterMl) totalWaterMl.textContent = totals.water.toFixed(2);

      const dailyUrine = calculateDailyUrineOutput();
      const dailyUrineOutput = document.getElementById('dailyUrineOutput');
      if (dailyUrineOutput) dailyUrineOutput.textContent = dailyUrine.toFixed(2);

      const warningsDiv = document.getElementById('warnings');
      if (warningsDiv) warningsDiv.innerHTML = '';

      updateChart('sodiumChart', 'Ø³Ø¯ÛŒÙ…', totals.sodium, limits.sodium, 'Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…');
      updateChart('potassiumChart', 'Ù¾ØªØ§Ø³ÛŒÙ…', totals.potassium, limits.potassium, 'Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…');
      updateChart('phosphorusChart', 'ÙØ³ÙØ±', totals.phosphorus, limits.phosphorus, 'Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…');
      updateChart('proteinChart', 'Ù¾Ø±ÙˆØªØ¦ÛŒÙ†', totals.protein, limits.protein, 'Ú¯Ø±Ù…');
      updateChart('waterChart', 'Ø¢Ø¨', totals.water, limits.water, 'Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±');
    }

    function updateChart(chartId, label, consumed, limit, unit) {
      const canvas = document.getElementById(chartId);
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      const percentage = Math.min((consumed / limit) * 100, 100);
      const remaining = Math.max(limit - consumed, 0);

      if (charts[chartId]) {
        charts[chartId].destroy();
      }

      charts[chartId] = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: [`${label} Ù…ØµØ±Ùâ€ŒØ´Ø¯Ù‡ (${unit})`, `${label} Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ (${unit})`],
          datasets: [{
            data: [consumed, remaining],
            backgroundColor: ['#42a5f5', '#e0e0e0'],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                font: {
                  size: parseInt(getComputedStyle(document.documentElement).fontSize)
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.raw;
                  return `${context.label}: ${value.toFixed(2)} ${context.label.includes('Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…') ? 'Ù…ÛŒÙ„ÛŒâ€ŒÚ¯Ø±Ù…' : context.label.includes('Ú¯Ø±Ù…') ? 'Ú¯Ø±Ù…' : 'Ù…ÛŒÙ„ÛŒâ€ŒÙ„ÛŒØªØ±'}`;
                }
              }
            }
          }
        }
      });
    }

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('https://sanaeih1.github.io/Dialysis11/service-worker.js?v=11').then(registration => {
          console.log('Service Worker registered with scope:', registration.scope);
        }).catch(error => {
          console.error('Service Worker registration failed:', error);
        });
      });
    }
  </script>
</body>
</html>